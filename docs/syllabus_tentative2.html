<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kwan To Wong">

<title>HKU SOCI7016 - Quantitative research methods – HKU SOCI7016 Quantitative Research Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">HKU SOCI7016 Quantitative Research Methods</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./syllabus_tentative2.html" aria-current="page"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">HKU SOCI7016 - Quantitative research methods</h1>
<p class="subtitle lead">2025 Fall</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kwan To Wong <a href="mailto:kwanto@hku.hk" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="course-details" class="level2">
<h2 class="anchored" data-anchor-id="course-details">Course details</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 27%">
<col style="width: 22%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>Format</th>
<th>Day</th>
<th>Time</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lectures</td>
<td>Wed (to be confirmed)</td>
<td>7pm - 9:50pm</td>
<td>TBA</td>
</tr>
</tbody>
</table>
</section>
<section id="course-objectives" class="level2">
<h2 class="anchored" data-anchor-id="course-objectives">Course objectives</h2>
<p>In this course, you will learn the basics of quantitative methods as applied to the social sciences. This involves two broad skill sets. First, a good command of the conceptual foundations of statistics is essential to understand why social scientists analyze data in some specific ways. Second, a hands-on experience in the computing and programming tools (R in our course) to both manage and analyze data is crucial to be able to apply the conceptual foundations of statistics to real-world data.</p>
</section>
<section id="course-learning-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="course-learning-outcomes">Course learning outcomes</h2>
<p>At the end of the course you should be able to:</p>
<ul>
<li>Use R for data analysis</li>
<li>Summarize and visualize data</li>
<li>Wrangle data into tidy forms</li>
<li>Understand the basic concepts of probability and statistics</li>
<li>Quantify uncertainty in data analysis</li>
<li>Be able to use regression models to analyze data</li>
</ul>
</section>
<section id="assessment-strategies-tentative" class="level2">
<h2 class="anchored" data-anchor-id="assessment-strategies-tentative">Assessment Strategies (tentative)</h2>
<ul>
<li>Class participation (10%)</li>
<li><strong>Midterm exam</strong> (40%)</li>
<li>Group Final project (50%)
<ul>
<li>proposal (10%)</li>
<li>presentation (20%)</li>
<li>a blog/website (20%)</li>
</ul></li>
</ul>
</section>
<section id="course-schedule" class="level2">
<h2 class="anchored" data-anchor-id="course-schedule">Course schedule</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 19%">
<col style="width: 74%">
</colgroup>
<thead>
<tr class="header">
<th>Week</th>
<th>Date</th>
<th>Topic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2025-09-03</td>
<td>Overview and Introduction to R</td>
</tr>
<tr class="even">
<td>2</td>
<td>2025-09-10</td>
<td>Data visualization</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2025-09-17</td>
<td>Data wrangling</td>
</tr>
<tr class="even">
<td>4</td>
<td>2025-09-24</td>
<td>Probability and distributions</td>
</tr>
<tr class="odd">
<td>5</td>
<td>2025-10-01</td>
<td>Sampling distributions</td>
</tr>
<tr class="even">
<td>6</td>
<td>2025-10-08</td>
<td>Confidence intervals and Hypothesis testing</td>
</tr>
<tr class="odd">
<td>7</td>
<td>2025-10-15</td>
<td>Reading Week</td>
</tr>
<tr class="even">
<td>8</td>
<td>2025-10-22</td>
<td>Linear regression I</td>
</tr>
<tr class="odd">
<td>9</td>
<td>2025-10-29</td>
<td>Linear regression II</td>
</tr>
<tr class="even">
<td>10</td>
<td>2025-11-05</td>
<td>Logistic regression and more</td>
</tr>
<tr class="odd">
<td>11</td>
<td>2025-11-12</td>
<td>Fixed-effects and DID</td>
</tr>
<tr class="even">
<td>12</td>
<td>2025-11-19</td>
<td><strong>Midterm</strong></td>
</tr>
<tr class="odd">
<td>13</td>
<td>2025-11-26</td>
<td>Final project presentations</td>
</tr>
</tbody>
</table>
</section>
<section id="midterm-exam" class="level2">
<h2 class="anchored" data-anchor-id="midterm-exam">Midterm exam</h2>
<p>The midterm exam will be on <strong>Nov 19th</strong>. It will last 150 mins. It will cover all the materials covered in the syllabus and it will be a in-class exam. If you miss it, you will fail in this part. You will not be allowed to collaborate with other students or be able to communicate with any humans/AI/Internets about the exam. More information about the exam will be provided as it approaches.</p>
</section>
<section id="group-final-project-presentation" class="level2">
<h2 class="anchored" data-anchor-id="group-final-project-presentation">Group Final project presentation</h2>
<p>Each group will have a group of 3 students, with plus/minus 1 flexibility. If you really want to do an individual project, please seek my approval first.</p>
<p>This is a <code>data analysis</code> project about a particular topic excites your group. No matter what the topic your group choose, your group need formula at least one key research question, find data to answer that question by using quantitative methods, and present those results for educated population.</p>
<ol type="1">
<li>A proposal (submission due: Nov 5th 5pm in Moodle)</li>
</ol>
<ul>
<li>write a short (one-page) proposal</li>
<li>state your research question</li>
<li>why this question is “interesting”</li>
<li>formulate a hypothesis related to the research question</li>
<li>where you will get the data to test the hypothesis</li>
</ul>
<!--

+ Describe your explanatory variable(s) of interest and how it is measured
  + need to observe variation in this variable in order to study it
+ Describe your outcome variable of interest and how it is measured
+ What observed pattern in the data would provide support for your hypothesis?
+ More importantly, what observed pattern would disprove your hypothesis?

-->
<ol start="2" type="1">
<li>The final project presentation (<strong>Nov 26th</strong>)</li>
</ol>
<p>It is an opportunity for you to present your final project to the class. The presentation should include the following:</p>
<ul>
<li>An introduction to the research question</li>
<li>An overview of the data, including its source, collection method, and any relevant background information</li>
<li>An overview of the methods used</li>
<li>visualization of the results</li>
<li>A brief discussion of the implications of the research for theory, policy or practice</li>
<li>A conclusion</li>
<li>A brief discussion of the limitations of the study (optional)</li>
<li>A brief discussion of the future directions of the research (optional)</li>
</ul>
<!--
+ To earn full credit on the visualizations and regression output, they should use informative labels and names and have a small number of digits presented

+ Tables should use kable or modelsummary to format output nicely
-->
<ol start="3" type="1">
<li>A blog/website (<strong>Nov 30th</strong>)</li>
</ol>
<ul>
<li><p>Present and interpret your findings in a blog not more than 800 words and attached with at least 3 visualization of data and results</p></li>
<li><p>published electronically online e.g.&nbsp;<a href="https://medium.com/">Medium</a>, <a href="https://shorthand.com/">Shorthand</a>, <a href="https://wordpress.com/">WordPress</a>, <a href="https://github.blog/">Github blog</a> or other online public platform.</p></li>
</ul>
</section>
<section id="textbooks-and-reference" class="level2">
<h2 class="anchored" data-anchor-id="textbooks-and-reference">Textbooks and Reference</h2>
<p>I will draw materials from the following books in this course:</p>
<ul>
<li><p>Imai, Kosuke and Nora Webb Willaims. 2022. Quantitative Social Science: An Introduction with Tidyverse, 2022. Princeton University Press.</p></li>
<li><p>Ismay, Chester and Albert Y. Kim. 2022. Statistical Inference via Data Science: A ModernDive into R and the Tidyverse.</p></li>
</ul>
</section>
<section id="late-policy" class="level2">
<h2 class="anchored" data-anchor-id="late-policy">Late Policy</h2>
<ul>
<li><p>All course work assignment due dates will not be deferred except in cases of medical emergencies or family bereavement, for which written evidence must be supplied.</p></li>
<li><p>Applications for extension of submission deadline must be made via email to the course instructor <strong>prior to the original deadline</strong>.</p></li>
<li><p>Late submissions will be penalized <strong>2 sub-grade</strong> if submitted 0-24 hours late and penalized <strong>4 sub-grade</strong> if submitted 24-48 hours late. We will not accept any submissions after 48 hours — we will get <strong>F</strong> for the task.</p></li>
<li><p>Technical difficulties are not acceptable reasons for lateness.</p></li>
</ul>
</section>
<section id="academic-honesty-and-plagiarism" class="level2">
<h2 class="anchored" data-anchor-id="academic-honesty-and-plagiarism">Academic honesty and plagiarism</h2>
<p>The university has high expectations for ethical conduct among students. Students must always pursue academic honesty in their studies, as this is a condition for authentic learning and creative intellectual contributions. Committing the following (including but not limited to) dishonest behaviour is unacceptable in any circumstances:</p>
<ul>
<li><p>Plagiarism (i.e.&nbsp;use of other people’s work without proper acknowledgement);</p></li>
<li><p>Submitting an assignment that is not the student’s own work, including the use of prior students’ work</p></li>
<li><p>Forgery of any document or certificate</p></li>
</ul>
<p>Please be reminded that disciplinary actions in connection with the violation of academic honesty may result in serious consequences. Plagiarism may be handled by the individual teacher or reported to the University Disciplinary Committee.</p>
<ul>
<li><p>Resources:</p>
<ul>
<li><a href="https://tl.hku.hk/plagiarism/">HKU Teaching &amp; Learning – Plagiarism</a></li>
<li><a href="https://learning.hku.hk/catalog/course/ilt01/">HKU Online Learning – Information Literacy Training: Academic Honesty</a></li>
</ul></li>
<li><p>In this class, we will use AI tools, including ChatGPT, that harness large language models as pedagogical opportunities for learning and teaching in the course. Doing so will align with one of our course goals, which pertains to the evaluation of arguments and justification with evidence.</p></li>
<li><p>Our class agreement will follow the University’s Policy on Use of Generative Artificial Intelligence for Teaching and Learning, which notes that “students who fail to make a full declaration and proper citation according to the course requirements may face disciplinary action”.</p></li>
<li><p>For this class, all submitted work should be written in your own words. Just as you cannot take credit for others’ writing in your assignments, you cannot use paraphrasing software (“spinbots”) or AI writing software (like ChatGPT) and submit the output as your own. Doing so in this is a violation of the University’s <a href="https://intraweb.hku.hk/reserved_1/tlearn/genai/gaitf-policy-dissemination-202309.pdf">Policy on Use of Generative Artificial Intelligence for Teaching and Learning</a>, which notes that “students who fail to make a full declaration and proper citation according to the course requirements may face disciplinary action”. At the beginning of the semester, we will identify examples of AI tools and discuss what constitutes plagiarism, cheating, and academic dishonesty. This will help to ensure that we are all on the same page about the policies for this course and how they connect to our learning outcomes.</p></li>
<li><p>Course privacy statement As noted in the Department’s Guidelines on the recording of lectures and teaching sessions, students may not audio or video record class meetings without permission from the instructor (and guest speakers, when applicable). If the instructor grants permission or if the teaching team posts videos themselves, students may keep recordings only for personal use and may not post recordings on the Internet, or otherwise distribute them. These policies protect the privacy rights of instructors and students, and the intellectual property and other rights of the university. Students who need lectures recorded for the purposes of an academic accommodation should contact CEDARS Special Educational Needs (SEN) Support.</p></li>
</ul>
</section>
<section id="research-ethics" class="level2">
<h2 class="anchored" data-anchor-id="research-ethics">Research ethics</h2>
<p>This course involves completion of a research project as coursework. If your research involves human participants, it is necessary to obtain ethical approval prior to collecting data. Application forms should be submitted to your instructor/tutor for endorsement and onward forwarding to the Department for processing.</p>
<p>We are expected to adhere to the highest ethical standards in Social Science Research. For example, the American Sociological Association’s <a href="https://www.asanet.org/wp-content/uploads/asa_code_of_ethics-june2018a.pdf">Code of Ethics</a> sets forth the principles and ethical standards that underlie sociologists’ scientific and professional responsibilities and conduct.</p>
</section>
<section id="student-wellbeing" class="level2">
<h2 class="anchored" data-anchor-id="student-wellbeing">Student wellbeing</h2>
<p>Life at university can get complicated. If you’re feeling stressed, overwhelmed, lost, anxious, depressed or are struggling with personal issues, do not hesitate to contact CEDARS <a href="https://www.cedars.hku.hk/cope/cps">Counselling and Psychological Services (CoPE)</a>. These services are free and completely confidential.</p>
<p>+Room 301-323, 3/F, Main Building</p>
<ul>
<li><p>3917 8388</p></li>
<li><p><a href="mailto:cedars-cope@hku.hk" class="email">cedars-cope@hku.hk</a></p></li>
<li><p><a href="https://www.cedars.hku.hk/cope/cps/appointment">CoPE appointment booking</a></p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>